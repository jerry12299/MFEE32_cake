<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蛋糕詳細頁</title>
    <link rel="stylesheet" href="../css/main_ginnychen19.css">
    <link rel="stylesheet" href="../css/permanentCake.css">
    <link rel="stylesheet" href="../css/PMCakeDetail.css">

    <script src="../js/jquery-3.6.0.js"></script>
</head>

<body>
    <nav>
        <p>我是Navbar</p>
    </nav>
    <div class="Our-newAD">
        <h4>我是廣告區</h4>
    </div>


    <div id="PMCakeDetail">
        <table class="PMCake_table">
            <thead>
                <th>主題蛋糕</th>
            </thead>
            <tbody class="list">
                <tr>
                    <td><a href="某某連結">2023季節主打</a></td>
                </tr>
                <tr>
                    <td><a href="某某連結">彌月蛋糕系列</a></td>
                </tr>
                <tr>
                    <td><a href="某某連結">重乳酪</a></td>
                </tr>
                <tr>
                    <td><a href="某某連結">生乳捲</a></td>
                </tr>
                <tr>
                    <td><a href="某某連結">配件區</a></td>
                </tr>

            </tbody>
        </table>

        <!--這個地方之後可以串，然後要用ejs-->
        <div class="PMCake_show">
            <div class="PMCake_show_content">
                <p>主題蛋糕 / <a href="某某網址">2023季節主打</a></p>
            </div>
            <div class="PMCake_show_detail">

                <div class="PMCake_show_detail_up">
                    <div class="cakePic">
                        <img class="mainPic" src="../Source/IMG/<%= data.img_name %>">
                        <figcaption>
                            <img class="smallPic" src="../Source/IMG/<%= data.img_name %>">
                            <img class="smallPic" src="../Source/IMG/<%= data.img_name %>">
                            <img class="smallPic" src="../Source/IMG/<%= data.img_name %>">
                            <img class="smallPic" src="../Source/IMG/<%= data.img_name %>">
                                 
                        </figcaption>
                    </div>
                    <div>
                        <div class="cakename">
                            <!-- <h6>法芙娜草莓布朗尼蛋糕</h6> -->
                            <h6><%= data.c_name %></h6>
                           
                        </div>
                        <div class="caketext"><p>
                            <!-- 堅持使用最新鮮且當季的大湖草莓製作，
                            鮮紅完熟的草莓散發自然甜香，顆顆飽
                            滿多汁使濃郁法芙娜巧克力布朗尼蛋糕
                            ，更添一股清爽風味！<br>
                            此款蛋糕僅提供【台中門市自取】，
                            因蛋糕使用鮮奶油以及新鮮草莓水果裝飾，
                            為避免宅配運送過程中損壞，故無法提供
                            宅配寄送服務。 -->
                            <%= data.illustrate%>
                        </p></div>
                        <div class="Size_Quantity_pirce">
                            <div>
                                <!-- <div class="selectSize">
                                    <p>尺寸：</p>
                                    <button>F</button>
                                    <button>6吋</button>
                                    <button>8吋</button>
                                </div> -->
                                <div class="selectQuantity">
                                    <p>數量：</p>
                                    <select name="quantity" id="number">
                                        <option value="1" selected="selected">1</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                    </select>
                                </div>
                            </div>
                            <pirce><h6>NT.<%= data.price%></h6></pirce>
                        </div>
                        <div class="gotocart">
                            <!-- <button id="buy"><a href="">直接購買</a></button> -->
                            <button id="buy">加入購物車</button>
                        </div>
                    </div>
                </div>

                <div class="PMCake_show_introduce">
                    123213145656436136
                </div>

            </div>
        </div>
    </div>


    <footer>
        <p>&nbsp;</p>
    </footer>

    <script src="../js/CustomizationCake.js"></script>
    <script>
        $('#buy').on('click',function(){
            var num = parseInt($('#number').val()) ;
            var cId = '<%= data.c_id %>';
            var cart = {
                name: cId,
                quantity: num,
            }
            var newcart = JSON.parse(localStorage.getItem("carts"))

            if (localStorage.carts === "[]") {//如果是空陣列
                console.log("是空陣列，將新物件推進陣列")
                var newcarts = []
                newcarts.push(cart)
                localStorage.setItem("carts", JSON.stringify(newcarts))
                console.log(localStorage)
            } else if (newcart) {//如果陣列裡有物件
                // console.log("陣列裡有物件，判斷物件名是否有相同")

                var carts = JSON.parse(localStorage.getItem("carts")) //現有資料

                var test = $.map(carts, function (item, index) {
                    return item.name;
                }).indexOf(cart.name);

                if (test === -1) {//判斷如果有相同物件
                    console.log("沒有相同物件，將新物件推入陣列中")
                    carts.push(cart)
                    localStorage.setItem("carts", JSON.stringify(carts))
                    console.log(localStorage)
                 
                } else {//判斷如果沒有相同物件
                    console.log("有相同物件，物件內數量加上新物件數量")
                    carts[test].quantity += cart.quantity
                    localStorage.setItem("carts", JSON.stringify(carts))
                    console.log(localStorage)
                }

            } else {//如果連陣列都沒有
                console.log("建立空陣列，將新物件推入陣列中")
                var newcarts = []
                newcarts.push(cart)
                localStorage.setItem("carts", JSON.stringify(newcarts))
                console.log(localStorage)
            }
        })
    </script>

</body>

</html>